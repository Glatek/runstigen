var ce=Object.defineProperty,de=Object.defineProperties,le=Object.getOwnPropertyDescriptors,G=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,Y=(e,o,h)=>o in e?ce(e,o,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[o]=h,me=(e,o)=>{for(var h in o||(o={}))ue.call(o,h)&&Y(e,h,o[h]);if(G)for(var h of G(o))pe.call(o,h)&&Y(e,h,o[h]);return e},fe=(e,o)=>de(e,le(o));(function(){"use strict";if("adoptedStyleSheets"in document)return;var e="ShadyCSS"in window&&!window.ShadyCSS.nativeShadow,o=[],h=[],a=new WeakMap,m=new WeakMap,t=new WeakMap,l=new WeakMap,y=new WeakMap,N={loaded:!1},g={body:null,CSSStyleSheet:null},U=CSSStyleSheet,X=/@import\surl(.*?);/gi;function j(n){return n instanceof U||n instanceof g.CSSStyleSheet}function Q(n,s){var r=s===document?"Document":"ShadowRoot";if(!Array.isArray(n))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+r+": Iterator getter is not callable.");if(!n.every(j))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+r+": Failed to convert value to 'CSSStyleSheet'");var i=n.filter(function(c,d){return n.indexOf(c)===d});return a.set(s,i),i}function k(){return document.readyState==="loading"}function W(n){return a.get(n.parentNode===document.documentElement?document:n)}function $(n){var s=n.match(X,"")||[],r=n;return s.length&&(console.warn("@import rules are not allowed here. See https://github.com/WICG/construct-stylesheets/issues/119#issuecomment-588352418"),s.forEach(function(i){r=r.replace(i,"")})),r}var ee=["addImport","addPageRule","addRule","deleteRule","insertRule","removeImport","removeRule"],te=["replace","replaceSync"];function q(n){te.forEach(function(s){n[s]=function(){return O.prototype[s].apply(this,arguments)}}),ee.forEach(function(s){var r=n[s];n[s]=function(){var i=arguments,c=r.apply(this,i);if(m.has(this)){var d=m.get(this),f=d.adopters,S=d.actions;f.forEach(function(u){u.sheet&&u.sheet[s].apply(u.sheet,i)}),S.push([s,i])}return c}})}function I(n){var s=m.get(n),r=s.adopters,i=s.basicStyleElement;r.forEach(function(c){c.innerHTML=i.innerHTML})}var O=function(){function n(){var r=document.createElement("style");N.loaded?g.body.appendChild(r):(document.head.appendChild(r),r.disabled=!0,o.push(r));var i=r.sheet;return m.set(i,{adopters:new Map,actions:[],basicStyleElement:r}),i}var s=n.prototype;return s.replace=function(r){var i=this,c=$(r);return new Promise(function(d,f){if(m.has(i)){var S=m.get(i),u=S.basicStyleElement;u.innerHTML=c,d(u.sheet),I(i)}else f(new Error("Can't call replace on non-constructed CSSStyleSheets."))})},s.replaceSync=function(r){var i=$(r);if(m.has(this)){var c=m.get(this),d=c.basicStyleElement;return d.innerHTML=i,I(this),d.sheet}else throw new Error("Failed to execute 'replaceSync' on 'CSSStyleSheet': Can't call replaceSync on non-constructed CSSStyleSheets.")},n}();Object.defineProperty(O,Symbol.hasInstance,{configurable:!0,value:j});function R(n){for(var s=document.createDocumentFragment(),r=W(n),i=l.get(n),c=0,d=r.length;c<d;c++){var f=m.get(r[c]),S=f.adopters,u=f.basicStyleElement,p=S.get(n);p?(i.disconnect(),s.appendChild(p),(!p.innerHTML||p.sheet&&!p.sheet.cssText)&&(p.innerHTML=u.innerHTML),i.observe()):(p=document.createElement("style"),p.innerHTML=u.innerHTML,t.set(p,n),y.set(p,0),S.set(n,p),s.appendChild(p)),n===document.head&&h.push(p)}n.insertBefore(s,n.firstChild);for(var w=0,L=r.length;w<L;w++){var v=m.get(r[w]),_=v.adopters,b=v.actions,C=_.get(n),se=y.get(C);if(b.length>0){for(var F=se,ae=b.length;F<ae;F++){var J=b[F],ie=J[0],he=J[1];C.sheet[ie].apply(C.sheet,he)}y.set(C,b.length-1)}}}function ne(n,s){for(var r=W(n),i=0,c=s.length;i<c;i++)if(!(r.indexOf(s[i])>-1)){var d=m.get(s[i]),f=d.adopters,S=l.get(n),u=f.get(n);u||(u=f.get(document.head)),S.disconnect(),u.parentNode.removeChild(u),S.observe()}}function re(n){for(var s=0,r=n.length;s<r;s++){for(var i=n[s],c=i.addedNodes,d=i.removedNodes,f=0,S=d.length;f<S;f++){var u=t.get(d[f]);u&&R(u)}if(!e)for(var p=0,w=c.length;p<w;p++)for(var L=document.createNodeIterator(c[p],NodeFilter.SHOW_ELEMENT,function(_){return _.shadowRoot&&_.shadowRoot.adoptedStyleSheets.length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},null,!1),v=void 0;v=L.nextNode();)R(v.shadowRoot)}}function z(n){var s=new MutationObserver(re),r={observe:function(){s.observe(n,{childList:!0,subtree:!0})},disconnect:function(){s.disconnect()}};l.set(n,r),r.observe()}function B(){var n=document.createElement("iframe");n.hidden=!0,document.body.appendChild(n),g.body=n.contentWindow.document.body,g.CSSStyleSheet=n.contentWindow.CSSStyleSheet,q(n.contentWindow.CSSStyleSheet.prototype),z(document.body),N.loaded=!0;for(var s=document.createDocumentFragment(),r=0,i=o.length;r<i;r++)o[r].disabled=!1,s.appendChild(o[r]);g.body.appendChild(s);for(var c=0,d=h.length;c<d;c++)s.appendChild(h[c]);document.body.insertBefore(s,document.body.firstChild),o.length=0,h.length=0}function oe(){var n={configurable:!0,get:function(){return a.get(this)||[]},set:function(r){var i=a.get(this)||[];Q(r,this);var c=this===document?k()?this.head:this.body:this,d="isConnected"in c?c.isConnected:document.body.contains(c);window.requestAnimationFrame(function(){d&&(R(c),ne(c,i))})}};if(Object.defineProperty(Document.prototype,"adoptedStyleSheets",n),typeof ShadowRoot<"u"){var s=Element.prototype.attachShadow;Element.prototype.attachShadow=function(){var r=e?this:s.apply(this,arguments);return z(r),r},Object.defineProperty(ShadowRoot.prototype,"adoptedStyleSheets",n)}}q(U.prototype),window.CSSStyleSheet=O,oe(),k()?document.addEventListener("DOMContentLoaded",B):B()})();function Se(e){return e.replace(/(-)([a-z])/g,o=>o[1].toUpperCase())}function V(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function T(e){return e?Array.from(e).reduce((o,{localName:h,value:a})=>fe(me({},o),{[Se(h)]:a}),{}):{}}function H(e){return document.createRange().createContextualFragment(e)}function ye(){let e=new CSSStyleSheet;return e.replace(String.raw(...arguments)),e}function ge(){let e=document.createElement("style");return e.innerText=String.raw(...arguments),e}function we(e,...o){let h=!1;try{new CSSStyleSheet,h=!0}catch{h=!1}return h?ye(e,...o):ge(e,...o)}function ve(){return H(String.raw(...arguments))}var A={},_e={},Ce=class extends HTMLElement{constructor(e){super(),e?this.componentPath=e:(console.warn("You did not send a path to the super method in your constructor. Thus CSS and HTML cannot be read for this component.",this),console.warn("If shipping for modern browser, then call super with import.meta.url. If not, specify a path that is similar to import.meta.url yourself."),console.warn("Should be the path to the component you are making."))}$(e){return this._sDOM.querySelector(e)}get cssPath(){return this.componentPath&&this.componentPath.replace(/\.(html|js)/gi,".css")}get htmlPath(){return this.componentPath&&this.componentPath.replace(/\.(css|js)/gi,".html")}get props(){return T(this.attributes)}async _render(){if(!_e[this.cssPath]&&this.cssPath){let o=await this.fetchCSSAsStyleSheet();this._sDOM.adoptedStyleSheets=[o]}let e=this.render(this.props);return H(e)}async fetchHTMLAsDocFrag(){let e=await fetch(this.htmlPath);if(e.ok){let o=await e.text();return H(o)}throw new Error("Fetch failed")}async fetchCSSAsStyleSheet(){let e=new CSSStyleSheet,o=await fetch(this.cssPath);if(o.ok&&o.headers.get("content-type").indexOf("text/css")!==-1){let h=await o.text();await e.replace(h)}return e}async _renderHTMLFile(){let e=btoa(this.componentPath);A[e]||(A[e]=Promise.all([this.fetchHTMLAsDocFrag(),this.fetchCSSAsStyleSheet()]));let[o,h]=await A[e];return this._sDOM.adoptedStyleSheets=[h],o.cloneNode(!0)}componentDidMount(){}async connectedCallback(){this._sDOM=this.attachShadow({mode:"closed"});let e;this.render?e=await this._render():this.componentPath?e=await this._renderHTMLFile():console.error("No render function or component path found for static html/css."),this._sDOM.innerHTML=null,this._sDOM.appendChild(e),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.componentDidMount&&this.componentDidMount()})})}};function Me(e,{name:o}={name:void 0}){let h="is"in e?e.is:e.prototype.constructor.name,a=o||V(h);return customElements.define(a,e),a}var Z=[],x=new Map,M=new Map,E=new Map,P=new Map,D=new Map,K=new Map;function be(e,{metaUrl:o,observedAttributes:h,name:a,shadowRootMode:m}){return class extends HTMLElement{constructor(){super(),this._postRender=void 0,this._propsChanged=void 0,this._hmrUpdate=!1,this._componentPath=o,this._hasRendered=!1,document.addEventListener("esm-hmr:webact-function-component",()=>{this._hmrUpdate=!0,e=x.has(a)?x.get(a):e,this._render()})}set _html(t){if(!M.has(a)||this._hmrUpdate){let l=document.createElement("template");l.content.appendChild(t),M.set(a,l)}}get _html(){return M.has(a)?M.get(a).content.cloneNode(!0):null}set _css(t){(!E.has(a)||this._hmrUpdate)&&E.set(a,t)}get _css(){return E.has(a)?E.get(a):null}get cssPath(){return this._componentPath&&this._componentPath.replace(/\.(html|js)/gi,".css")}get htmlPath(){return this._componentPath&&this._componentPath.replace(/\.(css|js)/gi,".html")}static get observedAttributes(){return h}async _render(t){this._rendering=e.apply(this.customThis,[t]),this._rendering instanceof Promise&&await this._rendering,this._css?("adoptedStyleSheets"in this._sDOM&&this._css instanceof CSSStyleSheet&&requestAnimationFrame(()=>{this._sDOM.adoptedStyleSheets=[this._css]}),this._css instanceof HTMLStyleElement&&this._sDOM.appendChild(this._css)):document.location.href.includes("localhost")&&console.warn(`<${a}>: Missing CSS. Will render without it.`),this._html?requestAnimationFrame(()=>this._sDOM.appendChild(this._html)):document.location.href.includes("localhost")&&console.warn(`<${a}>: Missing HTML. Will render without it.`),this._postRender instanceof Function&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this._postRender(),this._hmrUpdate=!1,this._hasRendered=!0})})}get _props(){return T(this.attributes)}get customThis(){return{html:(t,...l)=>{if(!(this._html!==null&&this._hmrUpdate===!1))return this._html=ve(t,...l),this._html},css:(t,...l)=>{if(!(this._css!==null&&this._hmrUpdate===!1))return this._css=we(t,...l),this._css},useHTML:async t=>{if(D.has(a))return D.get(a);if(t=t||this.htmlPath,!t)return;t instanceof URL&&(t=t.toString());let l=(async()=>{let y=await(await fetch(t)).text();this.customThis.html`${y}`})();return D.set(a,l),l},useCSS:async t=>{if(P.has(a))return P.get(a);if(t=t||this.cssPath,!t)return;t instanceof URL&&(t=t.toString());let l=(async()=>{let y=await(await fetch(t)).text();this.customThis.css`${y}`,P.delete(a)})();return P.set(a,l),l},postRender:t=>{this._postRender=t},deRender:t=>{this._deRender=t},propsChanged:t=>{this._propsChanged=t},$:t=>t===void 0||t===":host"?this:t===":root"?this._sDOM:this._sDOM.querySelector(t),$$:t=>this._sDOM.querySelectorAll(t)}}async attributeChangedCallback(){this._rendering instanceof Promise&&await this._rendering,requestAnimationFrame(()=>{if(this._propsChanged instanceof Function){let t=JSON.stringify(T(this.attributes));if(K.get(a)===t)return;this._propsChanged(T(this.attributes)),K.set(a,t)}else document.location.href.includes("localhost")&&console.error(`
            <${a}>: Attribute has changed and you are observing attributes, but not handling them in a propsChanged handler.
            Remove observedAttributes or or actually use them.
          `)})}async connectedCallback(){this._sDOM=this.attachShadow({mode:m||"closed"}),this._render(this._props)}disconnectedCallback(){this._deRender&&this._deRender()}}}function Ee(e,{metaUrl:o,observedAttributes:h,name:a,shadowRootMode:m}={metaUrl:void 0,observedAttributes:[],name:void 0,shadowRootMode:"closed"}){let t=a||V(e.name);if(customElements.get(t))if(Z.includes(t))x.set(t,e),document.dispatchEvent(new CustomEvent("esm-hmr:webact-function-component"));else throw new Error(`
        Some else has already registered <${t}> in the custom element registry.
      `);else{let l=be(e,{metaUrl:o,observedAttributes:h,name:t,shadowRootMode:m});customElements.define(t,l),Z.push(t)}return t}export{Ce as Component,Me as registerComponent,Ee as registerFunctionComponent};
